From d3f0e93f7c6a4248a46a1a57d95a69136f827458 Mon Sep 17 00:00:00 2001
From: Bodya-Kolibass <Mr.Kolibass@gmail.com>
Date: Tue, 24 Mar 2020 17:48:22 +0300
Subject: [PATCH] Allow Gui File Selector filter to check among more extensions

Change-Id: I98e355e6111a392f64ffa43024ffa3e6ae3b30be
---
 gui/Android.mk       |  1 +
 gui/fileselector.cpp | 19 ++++++++++++++-----
 2 files changed, 15 insertions(+), 5 deletions(-)

diff --git a/gui/Android.mk b/gui/Android.mk
index 22b5347..664966f 100644
--- a/gui/Android.mk
+++ b/gui/Android.mk
@@ -83,6 +83,7 @@ endif
 
 LOCAL_C_INCLUDES += \
     bionic \
+    system/core/base/include \
     system/core/include \
     system/core/libpixelflinger/include
 
diff --git a/gui/fileselector.cpp b/gui/fileselector.cpp
index fe378c8..8a86dea 100644
--- a/gui/fileselector.cpp
+++ b/gui/fileselector.cpp
@@ -20,6 +20,10 @@
 #include <sys/stat.h>
 #include <dirent.h>
 #include <algorithm>
+#include <vector>
+#include <android-base/parseint.h>
+#include <android-base/stringprintf.h>
+#include <android-base/strings.h>
 
 extern "C" {
 #include "../twcommon.h"
@@ -279,11 +283,16 @@ int GUIFileSelector::GetFileList(const std::string folder)
 			if (mShowNavFolders || (data.fileName != "." && data.fileName != ".."))
 				mFolderList.push_back(data);
 		} else if (data.fileType == DT_REG || data.fileType == DT_LNK || data.fileType == DT_BLK) {
-			if (mExtn.empty() || (data.fileName.length() > mExtn.length() && data.fileName.substr(data.fileName.length() - mExtn.length()) == mExtn)) {
-				if (mExtn == ".ab" && twadbbu::Check_ADB_Backup_File(path))
-					mFolderList.push_back(data);
-				else
-					mFileList.push_back(data);
+			std::vector<std::string> mExtnResults = android::base::Split(mExtn, ";");
+			for (const std::string& mExtnElement : mExtnResults)
+			{
+				std::string mExtnName = android::base::Trim(mExtnElement);
+				if (mExtnName.empty() || (data.fileName.length() > mExtnName.length() && data.fileName.substr(data.fileName.length() - mExtnName.length()) == mExtnName)) {
+					if (mExtnName == ".ab" && twadbbu::Check_ADB_Backup_File(path))
+						mFolderList.push_back(data);
+					else
+						mFileList.push_back(data);
+				}
 			}
 		}
 	}
-- 
2.17.1

