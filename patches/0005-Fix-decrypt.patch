From 63231d1456ce26619c8673faab7ae560d9b6d467 Mon Sep 17 00:00:00 2001
From: Bodya-Kolibass <Mr.Kolibass@gmail.com>
Date: Mon, 23 Mar 2020 18:55:12 +0300
Subject: [PATCH] Fix decrypt

Change-Id: I046c5fa4ec04378bb8ff23ad8e6b5a44b288f7c2
---
 Android.mk | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/Android.mk b/Android.mk
index 7a5ce5c..fcffdd9 100755
--- a/Android.mk
+++ b/Android.mk
@@ -521,10 +521,22 @@ endif
 
 ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 26; echo $$?),0)
     TWRP_REQUIRED_MODULES += ld.config.txt
+    ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 28; echo $$?),0)
     TWRP_REQUIRED_MODULES += init.recovery.ldconfig.rc
     LOCAL_POST_INSTALL_CMD += \
         sed 's/\(namespace.default.search.paths\)\s\{1,\}=/namespace.default.search.paths  = \/sbin\n\1 +=/' \
             $(TARGET_OUT_ETC)/ld.config*.txt > $(TARGET_RECOVERY_ROOT_OUT)/sbin/ld.config.txt;
+    else
+        ifeq ($(BOARD_VNDK_RUNTIME_DISABLE),true)
+            LOCAL_POST_INSTALL_CMD += \
+            sed '0,/^namespace.default.search.paths\s\{1,\}/!b;//a\namespace.default.search.paths += \/sbin' \
+                    $(TARGET_OUT_ETC)/ld.config.vndk_lite.txt > $(TARGET_RECOVERY_ROOT_OUT)/sbin/ld.config.txt;
+        else
+            LOCAL_POST_INSTALL_CMD += \
+            sed '0,/^namespace.default.search.paths\s\{1,\}/!b;//a\namespace.default.search.paths += \/sbin' \
+                    $(TARGET_OUT_ETC)/ld.config.txt > $(TARGET_RECOVERY_ROOT_OUT)/sbin/ld.config.txt;
+        endif
+    endif
 endif
 
 ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 25; echo $$?),0)
-- 
2.17.1

